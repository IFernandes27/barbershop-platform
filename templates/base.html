{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Barbershop{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    >

    <!-- CSS personalizado da barbearia -->
    <link rel="stylesheet" href="{% static 'barbershop/css/style.css' %}">
  </head>

  <body class="d-flex flex-column min-vh-100 bg-body">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">

            {% if not request.user.barbeiro %}
        <a class="navbar-brand fw-bold" href="{% url 'bookings:index' %}">
          Prime Barber
        </a>

           {% endif %}
           

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#mainNavbar" aria-controls="mainNavbar"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNavbar">



        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

    {% if user.is_authenticated %}

        {# --- SE FOR CLIENTE --- #}
        {% if not user.barbeiro %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'bookings:services_list' %}">
                    {% trans "Serviços" %}
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{% url 'bookings:dashboard' %}">
                    {% trans "Minhas marcações" %}
                </a>
            </li>
        {% endif %}

        {# --- SE FOR BARBEIRO --- #}
        {% if user.barbeiro %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'bookings:agenda_barbeiro' %}">
                    Agenda
                </a>
            </li>
        {% endif %}

    {% endif %}

</ul>


          <!-- Seletor de idioma -->
 


          <form id="language-form"
      action="{% url 'set_language' %}"
      method="post"
      class="d-flex me-3">
    {% csrf_token %}

    {# ESTE hidden será atualizado via JavaScript para manter a mesma página #}
    <input type="hidden" name="next" id="lang-next" value="{{ request.path }}">

    {% get_current_language as LANGUAGE_CODE %}
    {% get_available_languages as LANGUAGES %}

    <select name="language"
            id="language-select"
            class="form-select form-select-sm">
        {% for lang_code, lang_name in LANGUAGES %}
            <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}>
                {% if lang_code == 'pt' %}
                    Português
                {% elif lang_code == 'en' %}
                    English
                {% else %}
                    {{ lang_name }}
                {% endif %}
            </option>
        {% endfor %}
    </select>
</form>







          <!-- Autenticação -->
          {% if user.is_authenticated %}
            


{% if user.is_authenticated %}
<span class="navbar-text me-2">
    {% trans "Olá," %} {{ user.first_name|default:user.username }}
</span>
{% endif %}

            <form action="{% url 'accounts:logout' %}" method="post" class="d-inline">
              {% csrf_token %}
              <button class="btn btn-outline-light btn-sm" type="submit">
                {% trans "Sair" %}
              </button>
            </form>
          {% else %}
            <a class="btn btn-outline-light btn-sm me-2"
               href="{% url 'accounts:login' %}">
              {% trans "Entrar" %}
            </a>
            <a class="btn btn-primary btn-sm"
               href="{% url 'accounts:signup' %}">
              {% trans "Criar conta" %}
            </a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="flex-grow-1">
      {% block content %}{% endblock %}
    </main>

    <!-- Rodapé -->
    <footer class="bg-dark text-center text-white-50 py-3 mt-4">
      <small>
        © Prime Barber — {% trans "Todos os direitos reservados" %}
      </small>
    </footer>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous">
    </script>

    <!-- JS personalizado (se tiver) -->
    {# <script src="{% static 'barbershop/js/main.js' %}"></script> #}



    <script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("language-form");
    const select = document.getElementById("language-select");
    const nextInput = document.getElementById("lang-next");

    if (!form || !select || !nextInput) return;

    select.addEventListener("change", function () {
        const selectedLang = this.value;    // "pt" ou "en"
        const currentPath = "{{ request.path }}";  // ex: "/", "/en/services/", "/services/"

        let newPath = currentPath;

        if (selectedLang === "en") {
            // Garantir prefixo /en
            if (!currentPath.startsWith("/en/")) {
                if (currentPath === "/") {
                    newPath = "/en/";
                } else {
                    newPath = "/en" + currentPath;
                }
            }
        } else if (selectedLang === "pt") {
            // Remover prefixo /en se existir
            if (currentPath.startsWith("/en/")) {
                newPath = currentPath.slice(3) || "/";
            }
        }

        nextInput.value = newPath;
        form.submit();
    });
});
</script>

  </body>
</html>
